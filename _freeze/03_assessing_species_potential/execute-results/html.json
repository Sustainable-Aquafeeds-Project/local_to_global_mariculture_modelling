{
  "hash": "359b9abda6ae86ae8bb895fdbb4f80bc",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Assessing species potential\"\nauthor: Richard Cottrell\ndate: today\neditor: source\n---\n\n\n\nSet up\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(here)\nlibrary(janitor)\nlibrary(countrycode)\nlibrary(rnaturalearth)\n\nsource(\"src/dir.R\")\n```\n:::\n\n\n\nPull in FAO data for aquaculture production.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\naquaculture_raw <- read_csv(file.path(rdsi_dir, \"raw_data/fao/FAO_fishstat_2020/global_aquaculture_production_1950_2020.csv\"))\n\n\n(aquaculture_prod <- \n  aquaculture_raw |> \n  clean_names() |> \n  select(c(1:7, starts_with(\"x\"))) |> \n  pivot_longer(names_to = \"year\", values_to = \"production\", cols= -c(1:7)) |> \n  mutate(year = gsub(pattern=\"x\", replacement = \"\", year)) |> \n  filter(year %in% c(2015:2020)) |> \n  group_by(asfis_species_name_2, asfis_species_name_3, environment_name, year) |> \n  summarise(production = sum(production)) |> \n    ungroup() |> \n     filter(environment_name==\"Marine\" & \n           !asfis_species_name_3 %in% c(\"Clams, cockles, arkshells\", \n                                        \"Abalones, winkles, conchs\",\n                                        \"Mussels\", \n                                        \"Oysters\",\n                                        \"Shrimps, prawns\",\n                                        \"Crabs, sea-spiders\",\n                                         \"Freshwater molluscs\",\n                                        \"Squids, cuttlefishes, octopuses\",\n                                        \"Pearls, mother-of-pearl, shells\",\n                                        \"Miscellaneous aquatic plants\",\n                                        \"Scallops, pectens\"),\n         !grepl(\"seaweeds\" , asfis_species_name_3),\n         !grepl(\"molluscs|cucumber|invertebrates\", asfis_species_name_2)) |> \n    filter(!asfis_species_name_2 %in% c(\"Marine fishes nei\")) |> \n     group_by(asfis_species_name_2) |> \n     summarise(production = mean(production)) |> \n  arrange(-production) |> \n    mutate(cum_prop = cumsum(production)/sum(production),\n           prop = production/sum(production))\n)\n\n\nggplot(aquaculture_prod |> slice(1:20))+\n  aes(x = reorder(asfis_species_name_2, cum_prop), y = cum_prop)+\n  geom_col(fill = \"dodgerblue3\")+\n  theme_bw()+\n  theme(text = element_text(size=8),\n    axis.text.x = element_text(angle=45, hjust = 1))+\n  labs(x = \"\", y = \"Prop. global marine finfish aquaculture\")\n\n\nggsave(\"explore/cottrell_explore/global_proportion_finfish.jpg\", dpi = 600, width = 18, height = 12, units=\"cm\")\n  \n\n\n#\n\n\n(aquaculture_country_prod <- \n  aquaculture_raw |> \n  clean_names() |> \n  select(c(1:7, starts_with(\"x\"))) |> \n  pivot_longer(names_to = \"year\", values_to = \"production\", cols= -c(1:7)) |> \n  mutate(year = gsub(pattern=\"x\", replacement = \"\", year)) |> \n  filter(year %in% c(2015:2020)) |> \n  group_by(country_name, asfis_species_name_2, asfis_species_name_3, environment_name, year) |> \n  summarise(production = sum(production)) |> \n    ungroup() |> \n     filter(environment_name==\"Marine\" & \n           !asfis_species_name_3 %in% c(\"Clams, cockles, arkshells\", \n                                        \"Abalones, winkles, conchs\",\n                                        \"Mussels\", \n                                        \"Oysters\",\n                                        \"Shrimps, prawns\",\n                                        \"Crabs, sea-spiders\",\n                                         \"Freshwater molluscs\",\n                                        \"Squids, cuttlefishes, octopuses\",\n                                        \"Pearls, mother-of-pearl, shells\",\n                                        \"Miscellaneous aquatic plants\",\n                                        \"Scallops, pectens\"),\n         !grepl(\"seaweeds\" , asfis_species_name_3),\n         !grepl(\"molluscs|cucumber|invertebrates\", asfis_species_name_2)) |> \n     group_by(country_name, asfis_species_name_2) |> \n     summarise(production = mean(production)) |> \n  arrange(-production) |> \n    filter(!asfis_species_name_2 %in% c(\"Marine fishes nei\")) |> \n    ungroup() |> \n    mutate(prop = production/sum(production)) |> \n    group_by(country_name) |> \n    nest() |> \n    mutate(country_production =  map(data, ~(sum(.$production)))) |> \n    unnest(cols = c(data, country_production)) |> \n    ungroup() |> \n    arrange(-country_production)\n)\n\n\ntop_20_countries <- unique(aquaculture_country_prod$country_name)[1:20]\ntop_20_spp <- aquaculture_prod |> \n                  slice(1:20) |> \n                  pull(asfis_species_name_2) |> \n                  unique()\n\n\n\nggplot(aquaculture_country_prod |> \n         filter(country_name %in% top_20_countries & \n                  asfis_species_name_2 %in% top_20_spp) |> \n         mutate(asfis_species_name_2 = factor(asfis_species_name_2, levels = top_20_spp)))+\n  aes(x = reorder(asfis_species_name_2, -prop), y = production, fill = country_name)+\n  geom_col()+\n  theme_bw()+\n  theme(text = element_text(size=8),\n    axis.text.x = element_text(angle=45, hjust = 1),\n    legend.key.size = unit(0.4, \"cm\"))+\n  labs(x = \"\", y = \"Prop. global marine finfish aquaculture\", fill = \"\")\n\nggsave(\"explore/cottrell_explore/global_proportion_finfish_by_country.jpg\", dpi = 600, width = 18, height = 12, units=\"cm\")\n\n\naquaculture_prod |> filter(grepl(\"rouper\", asfis_species_name_2))\n```\n:::\n\n\n\nSpecies decided on:\n\n| Common name | Scientific name |\n|:----------------|:------------------------------------------------------|\n| Atlantic salmon | Salmo salar |\n| Other salmonids | Generalised multi-species model - incl. Oncorhynchus mykiss and Oncorhynchus kisutch (Coho) |\n| European seabass | Dicentrarchus labrax |\n| Gilthead seabream | Sparus aurata |\n| Large Yellow Croaker | Larimichthys crocea |\n| Japanese seabass | Lateolabrax japonicus |\n| Japanese amberjack | Seriola quinqueradiata |\n| Groupers | Generalised mutli-species model |\n| Pompano | Trachinotus blochii |\n| Milkfish | Chanos chanos |\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}